---
- hosts: localhost
  
  vars:
    applications:
      - alfred
      - neofetch

    install_oh_my_zsh: true

    brew_taps:
      - caskroom/cask

    brew_utils:
      - autoconf
      - autojump # quickly navigate from cmd line
      - bash # Bash 4
      - brew-cask
      - git
      - hub
      - tmux
      - wget

    zsh_path: /usr/local/bin/zsh

    home: "{{ lookup('env','HOME') }}"


  tasks:
    - name: Check Homebrew is installed
      stat: path=/usr/local/bin/brew
      register: brew_installed

    - name: Install Homebrew
      shell: ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
      when: brew_installed.stat.exists == false

#    - name: Install required Homebrew Taps
#      shell: brew tap {{ item }}
#      with_items: brew_taps

    - name: Check homebrew-cask is installed
      stat: path=/usr/local/bin/brew-cask.rb
      register: brew_cask_installed

    - name: Install homebrew-cask
      shell: brew install brew-cask-completion
      when: brew_cask_installed.stat.exists == false


    ### UTILS

#    - name: Install libraries/utils with homebrew
#      homebrew: name={{ item }} state=present
#      with_items: brew_utils

    - name: Install libraries/utils with homebrew
      homebrew: name="tmux" state=present
 


   
    - name: Cleanup after brewing
      shell: brew cleanup

    ### APPZ

    - name: Check for installed apps(casks)
      shell: brew list --cask | grep {{ item }}
      register: installed_applications
      with_items: applications
      ignore_errors: true
    
    - name: Install Apps with brew-cask
      shell: brew install {{ item }} --cask
      with_items: applications
      when: "{{ item not in installed_applications.results|map(attribute='stdout') }}"

